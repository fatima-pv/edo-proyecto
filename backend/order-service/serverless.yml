service: edo-order-service



provider:
  name: aws
  runtime: python3.9
  region: us-east-1
  environment:
    ORDERS_TABLE: EdoOrdersTable
    # Assuming State Machine ARN is exported or known. 
    # For now we will use a placeholder or assume it's passed via env vars in a real deployment.
    # We'll use a CloudFormation Output reference if deployed in same stack, but these are separate.
    # We will define it as an environment variable that needs to be set.
    STATE_MACHINE_ARN: ${param:STATE_MACHINE_ARN, 'arn:aws:states:us-east-1:123456789012:stateMachine:EdoOrderWorkflow'}
  iam:
    role: arn:aws:iam::520247722169:role/LabRole

functions:
  createOrder:
    handler: handler.create_order
    events:
      - http:
          path: orders
          method: post
          cors: true

  getOrders:
    handler: handler.get_orders
    events:
      - http:
          path: orders
          method: get
          cors: true

resources:
  Resources:
    EdoOrdersTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: EdoOrdersTable
        AttributeDefinitions:
          - AttributeName: tenant_id
            AttributeType: S
          - AttributeName: order_id
            AttributeType: S
          - AttributeName: status
            AttributeType: S
        KeySchema:
          - AttributeName: tenant_id
            KeyType: HASH
          - AttributeName: order_id
            KeyType: RANGE
        GlobalSecondaryIndexes:
          - IndexName: StatusIndex
            KeySchema:
              - AttributeName: status
                KeyType: HASH
            Projection:
              ProjectionType: ALL
        BillingMode: PAY_PER_REQUEST
